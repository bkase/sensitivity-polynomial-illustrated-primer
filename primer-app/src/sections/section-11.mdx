# Section 11: g-Transform Expectation is Nonzero

This section explains the Lean theorem `g_expectation_nonzero`, which shows that a specific sum (an expectation-like quantity) is nonzero when a Boolean function has full degree. The statement connects the top Fourier coefficient of a Boolean function to the nonvanishing of a signed sum involving the parity character.

## The Lean statement

```lean
theorem g_expectation_nonzero {n : ℕ} (f : (Fin n → Bool) → Bool)
  (h_deg : degree f = n) (hn : n ≠ 0) :
  let g := fun x => (if f x then 1 else 0) * chi Finset.univ x
  (Finset.sum Finset.univ g) ≠ 0 := by
  ...
```

### What it means in plain language

- We have a Boolean function \(f : \{0,1\}^n \to \{0,1\}\).
- The **Fourier degree** of \(f\) is \(n\), i.e., the largest \(|S|\) with \(\hat{f}(S) \neq 0\) equals \(n\).
- We define a transform \(g : \{0,1\}^n \to \mathbb{R}\) by:
\[
g(x) = \mathbf{1}_{f(x)=\text{true}} \cdot \chi_{[n]}(x)
\]
where \(\mathbf{1}_{f(x)=\text{true}}\) is 1 if \(f(x)\) is true, 0 otherwise, and \(\chi_{[n]}(x)\) is the full parity character (defined in **Section 3**).
- The theorem says \(\sum_{x \in \{0,1\}^n} g(x) \neq 0\).

**Codomain note**: The expression `(if f x then 1 else 0) * chi Finset.univ x` has type `ℝ` in Lean, since `chi` returns a real number (\(\pm 1\)) and the multiplication is in \(\mathbb{R}\).

This sum is (up to normalization) the Fourier coefficient at the full set \(S = [n]\). If the degree is \(n\), then this top coefficient is nonzero, so the sum cannot vanish.

## Intuition: why the sum is the Fourier coefficient

For a Boolean function, the Fourier coefficient at a set \(S\) is:
\[
\hat{f}(S) = \frac{1}{2^n} \sum_{x \in \{0,1\}^n} f(x) \cdot \chi_S(x)
\]

The Lean definition uses this same formula (see **Section 4**). The key observation is:
\[
\sum_x g(x) = \sum_x f(x) \cdot \chi_{[n]}(x) = 2^n \cdot \hat{f}([n])
\]

So the sum equals \(2^n\) times the Fourier coefficient at the full set. Since \(2^n \neq 0\), the sum is nonzero if and only if \(\hat{f}([n]) \neq 0\).

In the theorem:

- `S` is the full set `Finset.univ`.
- `f(x)` is represented as `(if f x then 1 else 0)` to move from `Bool` to `Nat` (or `Int`).
- `chi Finset.univ x` is the parity character on all `n` bits.

So the sum

```
Finset.sum Finset.univ (fun x => (if f x then 1 else 0) * chi Finset.univ x)
```

is exactly the (unnormalized) Fourier coefficient at the full set. If the degree is `n`, then the top coefficient is nonzero, and therefore the sum cannot be zero.

## How the Lean proof works

The proof is structured in three logical steps:

1. **Extract a nonzero top coefficient.**
   It proves there exists a set `S` of size `n` such that `fourier_coeff f S ≠ 0`. This uses the assumption `degree f = n` and a contradiction argument: if all size-`n` coefficients were zero, the degree would be at most `n-1`.

2. **Specialize to the full set.**
   For `Fin n`, the only subset of size \(n\) is `Finset.univ`. The argument is:
   - We have \(S \subseteq \text{Finset.univ}\) (any finset over `Fin n`)
   - We have \(|S| = n\)
   - But \(|\text{Finset.univ}| = n\) (since `Fintype.card (Fin n) = n`)
   - A subset of a finite set with equal cardinality must be the whole set

   Lean uses `Finset.eq_of_subset_of_card_le` to conclude \(S = \text{Finset.univ}\).

3. **Rewrite the coefficient as a sum.**
   After simplification, the coefficient is shown to be exactly the sum of `g(x)` over all `x`. Since the coefficient is nonzero, the sum is nonzero.

In Lean, those steps appear as:

```lean
have h_fourier_coeff : ∃ S : Finset (Fin n), fourier_coeff f S ≠ 0 ∧ S.card = n := by
  ...
obtain ⟨ S, hS₁, hS₂ ⟩ := h_fourier_coeff
simp_all +decide [ fourier_coeff ]
have := Finset.eq_of_subset_of_card_le ( Finset.subset_univ S )
...
```

The proof uses `simp_all` to unfold `fourier_coeff` and reduce to the explicit sum, and `Finset.eq_of_subset_of_card_le` to pin down `S = Finset.univ` from the cardinality equation.

## Takeaway

If a Boolean function has full Fourier degree, then its correlation with the full parity character is nonzero. The `g`-transform expectation encodes that correlation, so the sum (expectation) cannot vanish. This is a compact way to say: **full degree implies a nonzero top Fourier coefficient, which forces a nonzero global parity sum.**
